---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.MassAccess:massaccess.yml
  - docassemble.ALToolbox:collapse_template.yml
---
metadata:
  title: >-
    Utility Shutoff Prevention Form
  short title: >-
    Utility Protections
  description: |-
    This interview helps someone in Massachusetts write a letter to a utility company to prevent them from shutting off service.
  can_I_use_this_form: |
    If you are a doctor, you can use this interview to write a letter to a utility company.
  before_you_start: |
    This interview will help you write a letter to a utility company.
    
    Before you get started, please gather:
    
    1. Your patient's address.
    2. Your patient's utility company name and address.
    3. Your patient's utility account number.
    
    When you are finished, you will need to:
    
    1. Submit the letter.
  maturity: production
  estimated_completion_minutes: 10
  estimated_completion_delta: 5
  tags:
    - HE-00-00-00-00
    - FA-00-00-00-00
    - BE-00-00-00-00
    - DI-00-00-00-00
    - HO-00-00-00-00
    - GO-00-00-00-00
  authors:
    - Mark Marotta
  original_form: []
  original_form_published_on: ""
  help_page_url: >-
    https://www.masslegalhelp.org/housing-apartments-shelter/utilities/special-protections-against-shut-offs
  help_page_title: >-
    Mass Legal Help
  allowed_courts: []
  typical_role: "plaintiff"
  al_weaver_version: "1.11.0"
  generated_on: "2025-09-10"
  languages:
    - en
  jurisdiction: NAM-US-US+MA
  review_date: 2025-09-10
  form_titles:
    - Utility Shutoff Prevention Form
  form_numbers: []
  update_notes: |
    Form created in October 2025. 
---
code: |
  # This controls the default country and list of states in address field questions
  AL_DEFAULT_COUNTRY = "US"
---
code: |
  # This controls the default state in address field questions
  AL_DEFAULT_STATE = "MA"
---
code: |
  github_repo_name =  'docassemble-UtilityShutoffPreventionForm'
---
code: |
  interview_short_title = "Utility shut off letter"
---
code: |
  al_form_type = "letter" 
---
code: |
  al_person_answering = "doctor"
---
objects:
  - users: ALPeopleList.using(ask_number=True,target_number=1)
  - other_parties: ALPeopleList.using(ask_number=True,target_number=1)
  - plaintiffs: ALPeopleList.using(ask_number=True,target_number=1)
---
sections:
  - review_utility_shutoff_prevention_form: Review your answers
---
#################### Interview order #####################
comment: |
  Controls order and branching logic for questions specific to this form
id: interview_order_utility_shutoff_prevention_form
code: |
  # Set the allowed courts for this interview
  nav.set_section("review_utility_shutoff_prevention_form")
  user_role = "doctor"
  user_ask_role = "doctor"
  users[0].name.full()
  users[0].job_title
  users[0].business_name
  users[0].address.address
  users[0].mobile_number
  users[0].email
  users.gather()
  plaintiffs[0].illness
  if plaintiffs[0].illness == False:
      illness_exit_screen
  plaintiffs[0].name.full()
  plaintiffs[0].address.address
  knows_utility_account_number
  plaintiffs.gather()    
  other_parties[0].business_name
  other_parties[0].address.address
  knows_utility_account_number
  other_parties.gather()    
  set_progress(20)
  set_progress(40)  
  _date
  users[0].signature
  interview_order_utility_shutoff_prevention_form = True
---
###################### Main order ######################
comment: |
  This block includes the logic for standalone interviews.
  Delete mandatory: True to include in another interview
mandatory: True
code: |
  al_intro_screen
  utility_shutoff_prevention_form_intro
  interview_order_utility_shutoff_prevention_form
  signature_date
  # Store anonymous data for analytics / statistics
  store_variables_snapshot(
      persistent=True,
      data={
          "zip": showifdef("users[0].address.zip"),
          "reached_interview_end": True,
      },
  )
  utility_shutoff_prevention_form_download
---
id: Utility_Shutoff_Prevention_Form
continue button field: utility_shutoff_prevention_form_intro
question: |
  Utility shut off prevention form
subquestion: |
  This interview will help you write a letter to a utility company.
  
  Before you get started, please gather:
  
  1. Your patient's address.
  2. Your patient's utility company name and address.
  3. Your patient's utility account number.
  
  When you are finished, you will need to:
  
  1. Submit the letter via mail.

  If you are a doctor, you can use this interview to write a letter to a utility company.

  Most people take about 10 minutes to complete this interview.
---  
id: User's name
question: |
  What is your name?
fields:
  - First Name: users[0].name.first
  - Middle Name: users[0].name.middle
    required: False
  - Last Name: users[0].name.last
  - Suffix: users[0].name.suffix
    required: False
---
id: users business address
question: |
  What is your address?
fields:
  - Street address: users[0].address.street
  - City: users[0].address.city
  - State: users[0].address.state
    code: states_list()
  - Zip code: users[0].address.zip
    datatype: zip
---
id: user i's address
question: |
  What is your mailing address?
fields:
  - label: |
      % if i > 0 and al_person_answering == "user":
      Same as your address
      % else:
      Same as ${ users[0] }'s address
      % endif
    field: users[i].address
    datatype: object_radio
    choices:
      - users[0].address if defined("users[0].address.address") else None
    object labeler: |
      lambda y: y.on_one_line()      
    none of the above: |
      Somewhere else
    disable others: True
    show if:
      code: |
        i > 0 and defined("users[0].address.address")
  - ${ users[i].address.address_label}: users[i].address.address
    address autocomplete: True
  - ${ users[i].address.unit_label}: users[i].address.unit
    required: False
  - ${ users[i].address.city_label}: users[i].address.city
  - ${ users[i].address.state_label}: users[i].address.state
    code: |
      states_list(country_code=AL_DEFAULT_COUNTRY)
    default: ${ AL_DEFAULT_STATE }
  - ${ users[i].address.zip_label}: users[i].address.zip
    required: False
#  - ${ users[i].address.country_label}: users[i].address.country
#    code: countries_list()
#    default: ${ AL_DEFAULT_COUNTRY }
---
Id: Enter your info
question: |
  Tell us about your job 
fields:
  - "Employer name": users[0].business_name
  - "Job title": users[0].job_title
---
id: Patient's Utility Company Account Number
question: |
  Patient's Utility Company Account Number
fields:
  - "Do you know the patient's account number?": knows_utility_account_number
    datatype: yesnoradio 
  - "Patient's Utility Account Number": plaintiffs[0].account_number
    show if: knows_utility_account_number
---
id: Users Contact Info
question: |
  Provide at least **one** point of contact 
subquestion: |
  List a contact for the utility company to reach out to with any questions about your letter. 
fields: 
  - "Email address": users[0].mobile_number 
    required: False
  - "Phone number": users[0].email 
    required: False
---
id: Patient Name
question: |
  What is your patient's name?
fields:
  - Patient First Name: plaintiffs[0].name.first
  - Patient Middle Name: plaintiffs[0].name.middle
    required: False
  - Patient Last Name: plaintiffs[0].name.last
  - Suffix (if applicable): plaintiffs[0].name.suffix
    required: False
---
id: Today's Date
question: |
  When are you sending this letter? 
fields:
  - "Enter the date": _date
    datatype: date
    default: ${ today () }
---
id: Utility Company Name
question: |
  Utility Company Name
fields:
  - "Name of the utility company": other_parties[0].business_name
--- 
id: Utility Company Address
question: | 
  Utility Company Address
fields:
  - Street address: other_parties[0].address.street
  - City: other_parties[0].address.city
  - State: other_parties[0].address.state
    code: states_list()
  - Zip code: other_parties[0].address.zip
    datatype: zip
---
code: | 
  other_parties[0].name.first = other_parties[0].business_name
---
id: Patient's Illness
question: |
  Does your patient have a serious or chronic illness?
fields:
  - Select one: plaintiffs[0].illness
    datatype: yesnoradio
    required: True
  - note: |  
     ${ collapse_template(ma_serious_health_condition_definition) } 
     ${ collapse_template(chronic_condition_definition) }
       
---
template: ma_serious_health_condition_definition
subject: |
  MA serious health condition definition 
content: |
  Under MA law, a "serious health condition" is an illness, injury, impairment, or physical or mental condition that involves (i) inpatient care in a hospital, hospice, or residential medical facility; OR (ii) continuing treatment by a health care provider.
---
template: chronic_condition_definition
subject: |
  Chronic health condition definition 
content: |
  Under 29 CFR ยง825.115(c), a chronic condition is one which:

  1. Requires periodic visits (at least twice a year) for treatment by a health care provider, or by a nurse under direct supervision of a health care provider.
  2. Continues over an extended period of time.
  3. May cause episodic rather than a continuing period of incapacity (e.g., asthma, diabetes, epilepsy, etc.).
---
id: illness_exit_screen
event: illness_exit_screen
question: |
  This form can only be completed for patients who have a qualifying illness
subquestion: |
 You indicated that the patient does **not** have a serious or chronic illness.  
  This form is only for patients who meet that criteria.  

  If you selected "No" by mistake, click "undo" and change your answer.

 To learn more about statutory protections, visit this [link](https://malegislature.gov/Laws/GeneralLaws/PartI/TitleXXII/Chapter164/Section124a).

 For more general information, visit [Mass.gov](https://www.mass.gov/regulations/220-CMR-2500-billing-and-termination-procedures-of-the-department-of-public-utilities)
 
buttons:
  - Exit: exit
---
mandatory: True
code: |
  if plaintiffs[0].illness == "No":
      illness_exit_screen
---
id: preview utility_shutoff_prevention_form
question: |
  Preview your form before you sign it
subquestion: |
  Here is a preview of the form you will sign on the next page.   
  
  ${ al_recipient_bundle.as_pdf(key='preview') }

  Click the image to open it in a new tab. Click the "Edit answers" button
  to edit your answers.

  ${ action_button_html(url_action('review_utility_shutoff_prevention_form'), label='Edit answers', color='info') }
  
  Remember to come back to this window to continue and sign your form.
continue button field: utility_shutoff_prevention_form_preview_question    
---
code: |
  signature_fields = ['users[0].signature']
---
id: utility shutoff prevention form review screen
event: review_utility_shutoff_prevention_form
question: |
  Review your answers
review:
  - Edit: users.revisit
    button: |
      **Users**

      % for item in users:
        * ${ item }
      % endfor
  - Edit: _date
    button: |
      **Date of**:
      ${ _date }
  - Edit: plaintiffs.revisit
    button: |
      **Plaintiffs**

      % for item in plaintiffs:
        * ${ item }
      % endfor
  - Edit: other_parties.revisit
    button: |
      **Other parties**

      % for item in other_parties:
        * ${ item }
      % endfor
---
continue button field: users.revisit
question: |
  Edit users
subquestion: |
  ${ users.table }

  ${ users.add_action() }
---
table: users.table
rows: users
columns:
  - Job: |
      row_item.job if defined("row_item.job.title") else ""
  - Signature: |
      row_item.signature if defined("row_item.signature") else ""
  - Business name: |
      row_item.business_name if defined("row_item.business_name") else ""
  - Address: |
      row_item.address.block() if defined("row_item.address.address") else ""
edit:
  - job.title
  - signature
  - business_name
  - address.address
confirm: True

---
continue button field: plaintiffs.revisit
question: |
  Edit plaintiffs
subquestion: |
  ${ plaintiffs.table }

  ${ plaintiffs.add_action() }
---
table: plaintiffs.table
rows: plaintiffs
columns:
  - Address: |
      row_item.address.block() if defined("row_item.address.address") else ""
  - Account: |
      row_item.account if defined("row_item.account.number") else ""
  - Illness: |
      row_item.illness if defined("row_item.illness") else ""
  - Name: |
      row_item.name.full() if defined("row_item.name.first") else ""
edit:
  - address.address
  - account.number
  - illness
  - name.first
confirm: True

---
continue button field: other_parties.revisit
question: |
  Edit other_parties
subquestion: |
  ${ other_parties.table }

  ${ other_parties.add_action() }
---
table: other_parties.table
rows: other_parties
columns:
  - Business name: |
      row_item.business_name if defined("row_item.business_name") else ""
  - Address: |
      row_item.address.block() if defined("row_item.address.address") else ""
edit:
  - business_name
  - address.address
confirm: True

---
id: download utility_shutoff_prevention_form
event: utility_shutoff_prevention_form_download
question: |
  All done
subquestion: |
  Thank you ${users}. Your form is ready to download and deliver.
  
  View, download and send your form below. Click the "Edit answers" button to fix any mistakes.

  ${ action_button_html(url_action('review_utility_shutoff_prevention_form'), label='Edit answers', color='info') }
  
  
  ${ al_user_bundle.download_list_html() }
  

  ${ al_user_bundle.send_button_html(show_editable_checkbox=True) }

progress: 100
---
# ALDocument objects specify the metadata for each template
objects:
  - utility_shutoff_prevention_form_Post_interview_instructions: ALDocument.using(title="Instructions", filename="utility_shutoff_prevention_form_next_steps.docx", enabled=True, has_addendum=False)
  - utility_shutoff_prevention_form_attachment: ALDocument.using(title="Utility Shutoff Prevention Form", filename="utility_shutoff_prevention_form", enabled=True, has_addendum=False, )
---
# Bundles group the ALDocuments into separate downloads, such as for court and for the user
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[utility_shutoff_prevention_form_Post_interview_instructions, utility_shutoff_prevention_form_attachment], filename="utility_shutoff_prevention_form", title="All forms to download for your records", enabled=True)
  - al_recipient_bundle: ALDocumentBundle.using(elements=[utility_shutoff_prevention_form_attachment],  filename="utility_shutoff_prevention_form", title="All forms to file", enabled=True)
---
# Each attachment defines a key in an ALDocument. We use `i` as the placeholder here so the same template is 
# used for "preview" and "final" keys, and logic in the template checks the value of 
# `i` to show or hide the user's signature
attachment:
  name: Post-interview-Instructions
  filename: utility_shutoff_prevention_form_next_steps
  docx template file: utility_shutoff_prevention_form_next_steps.docx
  variable name: utility_shutoff_prevention_form_Post_interview_instructions[i]
  skip undefined: True
  tagged pdf: True
---
attachment:
  name: utility shutoff prevention form
  filename: utility_shutoff_prevention_form
  variable name: utility_shutoff_prevention_form_attachment[i]
  skip undefined: True
  docx template file: utility_shutoff_prevention_form.docx
  tagged pdf: True



